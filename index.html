<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cricket Scoring App</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Screen 1: Create Match -->
  <div id="teamNamesScreen" class="screen">
    <div class="container">
      <h1>Create Match</h1>
      <form id="teamNamesForm">
        <div class="input-row">
          <span>Team 1</span>
          <input type="text" id="team1Name" required>
        </div>
        <div class="input-row">
          <span>Team 2</span>
          <input type="text" id="team2Name" required>
        </div>
        <div class="input-row">
          <span>Match Overs</span>
          <input type="number" id="matchOvers" required>
        </div>
        <button type="submit">Start Scoring</button>
      </form>
    </div>
  </div>

  <!-- Screen 2: Scoring Interface -->
  <div id="scoringScreen" class="screen hidden">
    <div class="container">
      <!-- Score Display -->
      <div class="score-display">
        <p id="team1ScoreDisplay">Australia 140/3 (15.1)</p>
        <p id="team2ScoreDisplay">India 130/3 (15.1)</p>
        <p id="matchOversDisplay">(40 Overs Match)</p>
      </div>
      <!-- Team 1 Section -->
      <div class="team-section">
        <h2 id="team1Display" class="highlight-yellow"></h2>
        <h3>Runs</h3>
        <div class="buttons">
          <button onclick="addScore(1, 1)" class="runs-button">1</button>
          <button onclick="addScore(2, 1)" class="runs-button">2</button>
          <button onclick="addScore(3, 1)" class="runs-button">3</button>
          <button onclick="addScore(4, 1)" class="runs-button">4</button>
          <button onclick="addScore(5, 1)" class="runs-button">5</button>
          <button onclick="addScore(6, 1)" class="runs-button">6</button>
          <button onclick="addWicket(1)" class="wicket-button">Wkt</button>
        </div>
        <h3>Add Extras</h3>
        <div class="buttons">
          <button onclick="addExtra(1, 1)" class="extras-button">1</button>
          <button onclick="addExtra(2, 1)" class="extras-button">2</button>
          <button onclick="addExtra(3, 1)" class="extras-button">3</button>
          <button onclick="addExtra(4, 1)" class="extras-button">4</button>
          <button onclick="addExtra(5, 1)" class="extras-button">5</button>
          <button onclick="addExtra(6, 1)" class="extras-button">6</button>
          <button onclick="addExtra(7, 1)" class="extras-button">7</button>
        </div>
        <button onclick="undoLast(1)" class="undo-button">Undo</button>
      </div>
      <!-- Team 2 Section -->
      <div class="team-section">
        <h2 id="team2Display" class="highlight-yellow"></h2>
        <h3>Runs</h3>
        <div class="buttons">
          <button onclick="addScore(1, 2)" class="runs-button">1</button>
          <button onclick="addScore(2, 2)" class="runs-button">2</button>
          <button onclick="addScore(3, 2)" class="runs-button">3</button>
          <button onclick="addScore(4, 2)" class="runs-button">4</button>
          <button onclick="addScore(5, 2)" class="runs-button">5</button>
          <button onclick="addScore(6, 2)" class="runs-button">6</button>
          <button onclick="addWicket(2)" class="wicket-button">Wkt</button>
        </div>
        <h3>Add Extras</h3>
        <div class="buttons">
          <button onclick="addExtra(1, 2)" class="extras-button">1</button>
          <button onclick="addExtra(2, 2)" class="extras-button">2</button>
          <button onclick="addExtra(3, 2)" class="extras-button">3</button>
          <button onclick="addExtra(4, 2)" class="extras-button">4</button>
          <button onclick="addExtra(5, 2)" class="extras-button">5</button>
          <button onclick="addExtra(6, 2)" class="extras-button">6</button>
          <button onclick="addExtra(7, 2)" class="extras-button">7</button>
        </div>
        <button onclick="undoLast(2)" class="undo-button">Undo</button>
      </div>
    </div>
  </div>

  <script>
    // Team data
    let team1 = { name: '', score: 0, wickets: 0, overs: 0 };
    let team2 = { name: '', score: 0, wickets: 0, overs: 0 };
    let matchOvers = 0;
    let history = { team1: [], team2: [] }; // To store last 6 inputs for undo

    // Google Apps Script URL
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbz1mbfq-uLutaFnQOQv3Fm4LT5ZVzCEeSkf_vUISDO-/dev';

    // Screen elements
    const teamNamesScreen = document.getElementById('teamNamesScreen');
    const scoringScreen = document.getElementById('scoringScreen');
    const team1Display = document.getElementById('team1Display');
    const team2Display = document.getElementById('team2Display');
    const team1ScoreDisplay = document.getElementById('team1ScoreDisplay');
    const team2ScoreDisplay = document.getElementById('team2ScoreDisplay');
    const matchOversDisplay = document.getElementById('matchOversDisplay');

    // Handle team names form submission
    document.getElementById('teamNamesForm').addEventListener('submit', function (e) {
      e.preventDefault();
      team1.name = document.getElementById('team1Name').value;
      team2.name = document.getElementById('team2Name').value;
      matchOvers = document.getElementById('matchOvers').value;
      team1Display.textContent = team1.name;
      team2Display.textContent = team2.name;
      matchOversDisplay.textContent = `(${matchOvers} Overs Match)`;
      teamNamesScreen.classList.add('hidden');
      scoringScreen.classList.remove('hidden');
      updateScoreDisplay();
    });

    // Add runs to the score and overs
    function addScore(runs, team) {
      const currentTeam = team === 1 ? team1 : team2;
      currentTeam.score += runs;
      currentTeam.overs += 0.1;
      if (currentTeam.overs % 1 > 0.5) currentTeam.overs = Math.round(currentTeam.overs); // Round overs
      updateHistory(currentTeam, { score: runs, overs: 0.1, wickets: 0 });
      updateScoreDisplay();
      sendDataToSheet();
    }

    // Add extras to the score (no overs)
    function addExtra(runs, team) {
      const currentTeam = team === 1 ? team1 : team2;
      currentTeam.score += runs;
      updateHistory(currentTeam, { score: runs, overs: 0, wickets: 0 });
      updateScoreDisplay();
      sendDataToSheet();
    }

    // Add wicket
    function addWicket(team) {
      const currentTeam = team === 1 ? team1 : team2;
      currentTeam.wickets += 1;
      updateHistory(currentTeam, { score: 0, overs: 0, wickets: 1 });
      updateScoreDisplay();
      sendDataToSheet();
    }

    // Undo last input
    function undoLast(team) {
      const currentTeam = team === 1 ? team1 : team2;
      const lastAction = history[`team${team}`].pop();
      if (lastAction) {
        currentTeam.score -= lastAction.score;
        currentTeam.overs -= lastAction.overs;
        currentTeam.wickets -= lastAction.wickets;
        updateScoreDisplay();
        sendDataToSheet();
      }
    }

    // Update history
    function updateHistory(team, action) {
      const teamKey = team === team1 ? 'team1' : 'team2';
      history[teamKey].push(action);
      if (history[teamKey].length > 6) history[teamKey].shift(); // Keep only last 6 inputs
    }

    // Update the score display
    function updateScoreDisplay() {
      team1ScoreDisplay.textContent = `${team1.name} ${team1.score}/${team1.wickets} (${team1.overs.toFixed(1)})`;
      team2ScoreDisplay.textContent = `${team2.name} ${team2.score}/${team2.wickets} (${team2.overs.toFixed(1)})`;
    }

    // Send data to Google Sheet
    function sendDataToSheet() {
      const data = {
        team1Name: team1.name,
        team1Score: team1.score,
        team1Wickets: team1.wickets,
        team1Overs: team1.overs,
        team2Name: team2.name,
        team2Score: team2.score,
        team2Wickets: team2.wickets,
        team2Overs: team2.overs,
      };

      fetch(scriptUrl, {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => response.json())
        .then(result => {
          console.log('Response:', result);
          if (result.success) {
            alert('Score updated successfully!');
          } else {
            alert('Failed to update score.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to update score.');
        });
    }
  </script>
</body>
</html>
